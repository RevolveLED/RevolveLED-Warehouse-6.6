{{ 'section-main-product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'section-main-product.js' | asset_url }}" defer></script>

{%- assign shipping_estimator_block = section.blocks | where: 'type', 'shipping_estimator' | first -%}
{%- assign variant_selector_block = section.blocks | where: 'type', 'variant_selector' | first -%}
{%- assign buy_buttons_block = section.blocks | where: 'type', 'buy_buttons' | first -%}

{%- capture section_settings -%}
{
  "showShippingEstimator": {% if template == 'product.quick-view' or product.available == false or shipping_estimator_block == blank %}false{% else %}true{% endif %},
  "galleryTransitionEffect": {{ section.settings.carousel_effect | json }},
  "enableImageZoom": {% if template == 'product.quick-view' %}false{% else %}{{ section.settings.enable_image_zoom | json }}{% endif %},
  "zoomEffect": {{ section.settings.zoom_effect | json }},
  "enableVideoLooping": {{ section.settings.enable_video_looping | json }},
  "productOptions": {{ product.options | json | escape }},
  "infoOverflowScroll": {% if template == 'product.quick-view' %}false{% else %}true{% endif %},
  "isQuickView": false
}
{%- endcapture -%}

<section
  data-section-id="{{ section.id }}"
  data-section-type="product"
  data-section-settings="{{ section_settings | escape_once }}"
>
  <div class="container">
    <div class="page__sub-header">
      <nav aria-label="{{ 'general.breadcrumb.title' | t }}" class="breadcrumb">
        <ol class="breadcrumb__list" role="list">
          <li class="breadcrumb__item">
            <a class="breadcrumb__link link" href="{{ routes.root_url }}">{{ 'general.breadcrumb.home' | t }}</a>
            {%- render 'icon', icon: 'arrow-right' -%}
          </li>

          <li class="breadcrumb__item">
            {%- if collection -%}
              <a class="breadcrumb__link link" href="{{ collection.url }}">{{ collection.title }}</a>
              {%- render 'icon', icon: 'arrow-right' -%}
            {%- else -%}
              <a class="breadcrumb__link link" href="{{ routes.all_products_collection_url }}">
                {{- 'collection.general.all_products' | t -}}
              </a>
              {%- render 'icon', icon: 'arrow-right' -%}
            {%- endif -%}
          </li>

          <li class="breadcrumb__item">
            <span class="breadcrumb__link" aria-current="page">{{ product.title }}</span>
          </li>
        </ol>
      </nav>

      {%- if collection.previous_product or collection.next_product -%}
        <div class="page__navigation">
          {%- if collection.previous_product -%}
            <span class="page__navigation-item page__navigation-item--prev">
              <a href="{{ collection.previous_product.url }}" class="link" rel="prev">
                {%- render 'icon', icon: 'arrow-left' -%}
                {{- 'product.general.previous_product' | t -}}
              </a>
            </span>
          {%- endif -%}

          {%- if collection.next_product -%}
            <span class="page__navigation-item page__navigation-item--next">
              <a href="{{ collection.next_product.url }}" class="link" rel="next">
                {{- 'product.general.next_product' | t -}}
                {%- render 'icon', icon: 'arrow-right' -%}
              </a>
            </span>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>

    {%- capture product_form_id -%}product-form-main-{{ product.id }}-{{ section.id }}{%- endcapture -%}

    <product-rerender
      id="product-info-{{ product.id }}-{{ section.id }}"
      observe-form="{{ product_form_id }}"
      allow-partial-rerender
    >
      <div class="product-information">
        <div class="product-information__grid">
          <div class="product-gallery-wrapper">
            {%- if product.media.size > 0 -%}
              {% render 'product-gallery', product_form_id: product_form_id %}
            {%- endif -%}
            {%- render 'product-short-desc', class: 'hidden-pocket' -%}
          </div>

          {%- render 'product-info', product: product, product_form_id: product_form_id, update_url: true -%}
        </div>
      </div>
    </product-rerender>
  </div>
</section>

{%- comment -%}We display the quick view within the product template so we can re-use the same settings{%- endcomment -%}
{%- capture product_form_id -%}product-form-quick-buy-{{ product.id }}-{{ section.id }}{%- endcapture -%}

{%- capture quick_buy_section_settings -%}
{
  "showShippingEstimator": false,
  "galleryTransitionEffect": {{ section.settings.carousel_effect | json }},
  "enableImageZoom": {% if template == 'product.quick-view' %}false{% else %}{{ section.settings.enable_image_zoom | json }}{% endif %},
  "zoomEffect": {{ section.settings.zoom_effect | json }},
  "enableVideoLooping": {{ section.settings.enable_video_looping | json }},
  "infoOverflowScroll": false,
  "productOptions": {{ product.options | json | escape }},
  "isQuickView": true
}
{%- endcapture -%}

{% comment %}
  The quick buy content is rendered as a template to ensure it does not appear on actual product pages. It is extracted by quick view scripts
  and injected only on quick buy modal
{% endcomment %}
<template>
  <section
    data-section-id="{{ section.id }}"
    data-section-type="product-quick-view"
    data-section-settings="{{ quick_buy_section_settings | escape_once }}"
  >
    <product-rerender id="quick-buy-modal-content" observe-form="{{ product_form_id }}" allow-partial-rerender>
      <div class="featured-product product-information__grid">
        <div class="product-gallery-wrapper">
          {%- render 'product-gallery' -%}
        </div>
        {%- render 'product-info', product: product, product_form_id: product_form_id -%}
      </div>
    </product-rerender>
  </section>
</template>

<!-- BEGIN: 10/28/2025 gio disable product fixed bar -->
{% if template.suffix == 'contact-2' %}
  <!-- hide the fix bar to add to cart -->
{%  else %}
{%- render 'product-fixed-bar', product: product -%}
{%  endif %}
<!-- END: gio disable product fixed bar -->
<script>
  window.ShopifyXR=window.ShopifyXR||function(){(ShopifyXR.q=ShopifyXR.q||[]).push(arguments)};
  ShopifyXR('addModels', {{ product.media | where: 'media_type', 'model' | json }});

  // We save the ID of the product in the local storage, as it can be used by the "recently viewed products" section
  (() => {
    let items = JSON.parse(localStorage.getItem('recentlyViewedProducts') || '[]');

    // If the product already exists we first remove it
    if (items.includes({{product.id | json}})) {
      items.splice(items.indexOf({{ product.id | json }}), 1);
    }

    items.unshift({{ product.id | json }});

    // Then, we save the current product into the local storage, by keeping only the 18 most recent
    try {
      localStorage.setItem('recentlyViewedProducts', JSON.stringify(items.slice(0, 18)));
    } catch (error) {
      // Do nothing, this may happen in Safari in incognito mode
    }
  })();
</script>

{% schema %}
{
  "name": "Product",
  "blocks": [
    {
      "type": "product_meta",
      "name": "Product meta",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_vendor",
          "label": "Show vendor",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_sku",
          "label": "Show SKU",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "show_reviews_badge",
          "label": "Show product rating",
          "info": "To display a rating, add a product rating app. [Learn more](https://help.shopify.com/en/manual/products/product-reviews/installation)",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_share_buttons",
          "label": "Show share buttons",
          "default": false
        }
      ]
    },
    {
      "type": "product_meta_shift",
      "name": "Product meta (shift)",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_bulletpoints",
          "label": "Show bulletpoints",
          "default": true
        }
      ]
    },
    {
      "type": "variant_selector",
      "name": "Variant selector",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "selector_mode",
          "label": "Selector type",
          "options": [
            {
              "value": "block",
              "label": "Block"
            },
            {
              "value": "dropdown",
              "label": "Dropdown"
            }
          ],
          "default": "block"
        },
        {
          "type": "select",
          "id": "color_mode",
          "label": "Color selector type",
          "info": "Enable [swatches](https://help.shopify.com/en/manual/online-store/themes/theme-structure/theme-settings#options-with-swatches) on product options.",
          "options": [
            {
              "value": "swatch",
              "label": "Swatch"
            },
            {
              "value": "none",
              "label": "None"
            }
          ],
          "default": "swatch"
        },
        {
          "type": "text",
          "id": "variant_image_options",
          "label": "Show variant image for options"
        },
        {
          "type": "checkbox",
          "id": "show_quantity_selector",
          "label": "Show quantity selector",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_taxes_included",
          "label": "Show price taxes notice",
          "default": false
        },
        {
          "type": "header",
          "content": "Inventory"
        },
        {
          "type": "checkbox",
          "id": "show_inventory_quantity",
          "label": "Show inventory quantity",
          "default": false
        },
        {
          "type": "range",
          "id": "low_inventory_threshold",
          "label": "Low inventory threshold",
          "info": "Use low stock color when quantity is below the threshold. Choose 0 to always show in stock.",
          "min": 0,
          "max": 100,
          "step": 1,
          "default": 0,
          "visible_if": "{{ block.settings.show_inventory_quantity }}"
        },
        {
          "type": "number",
          "id": "progress_bar_max_value",
          "label": "Progress bar max value",
          "info": "Advancement is calculated according to this value.",
          "default": 50,
          "visible_if": "{{ block.settings.show_inventory_quantity }}"
        }
      ]
    },
    {
      "type": "volume_pricing",
      "name": "Volume pricing table",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Volume pricing is only available to Shopify Plus merchants. [Learn more](https://help.shopify.com/en/manual/b2b/catalogs/quantity-pricing#volume-pricing)"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_payment_button",
          "label": "Show dynamic checkout button",
          "info": "Each customer will see their preferred payment method from those available on your store, such as PayPal or Apple Pay. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_gift_card_recipient",
          "label": "Show recipient information form for gift card products",
          "info": "Gift card products can optionally be sent directly to a recipient along with a personal message. [Learn more](https://help.shopify.com/manual/online-store/themes/customizing-themes/add-gift-card-recipient-fields)",
          "default": true
        }
      ]
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "paragraph",
          "content": "This text will appear on the right part of the page."
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Text"
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "settings": [
        {
          "type": "paragraph",
          "content": "This button will appear on the right part of the page."
        },
        {
          "type": "text",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    },
    {
      "type": "store_pickup",
      "name": "Local pickup availability",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Show customers where they can pick up the product. [Learn more](https://help.shopify.com/en/manual/shipping/setting-up-and-managing-your-shipping/local-methods/local-pickup#show-pickup-availability-to-your-customers)"
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "display_mode",
          "label": "Display mode",
          "options": [
            {
              "value": "collapse",
              "label": "Collapse"
            },
            {
              "value": "view_more",
              "label": "Show view more if long"
            },
            {
              "value": "show_all",
              "label": "Show all"
            }
          ],
          "default": "show_all"
        }
      ]
    },
    {
      "type": "content",
      "name": "Content",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Content from page",
          "info": "If specified, takes precedence over inline content."
        },
        {
          "type": "select",
          "id": "display_mode",
          "label": "Display mode",
          "options": [
            {
              "value": "collapse",
              "label": "Collapse"
            },
            {
              "value": "view_more",
              "label": "Show view more if long"
            },
            {
              "value": "show_all",
              "label": "Show all"
            }
          ],
          "default": "show_all"
        }
      ]
    },
    {
      "type": "liquid",
      "name": "Liquid",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "liquid",
          "id": "liquid",
          "label": "Liquid code",
          "default": "{{ product.title }}"
        },
        {
          "type": "select",
          "id": "display_mode",
          "label": "Display mode",
          "options": [
            {
              "value": "collapse",
              "label": "Collapse"
            },
            {
              "value": "view_more",
              "label": "Show view more if long"
            },
            {
              "value": "show_all",
              "label": "Show all"
            }
          ],
          "default": "show_all"
        }
      ]
    },
    {
      "type": "complementary_products",
      "name": "Complementary products",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "To select complementary products, use the Search & Discovery app. [Learn more](https://help.shopify.com/en/manual/online-store/search-and-discovery/product-recommendations#complementary-products)"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Pairs well with"
        },
        {
          "type": "range",
          "id": "products_count",
          "min": 1,
          "max": 10,
          "label": "Products count",
          "default": 10
        },
        {
          "type": "checkbox",
          "id": "show_quick_buy",
          "label": "Show quick buy",
          "default": true
        }
      ]
    },
    {
      "type": "shipping_estimator",
      "name": "Shipping estimator",
      "settings": [
        {
          "type": "text",
          "id": "shipping_estimator_default_country",
          "label": "Default country",
          "info": "If the customer is logged in, the country of their shipping address will be used.",
          "default": "United States"
        },
        {
          "type": "checkbox",
          "id": "show_refunds_policy",
          "label": "Show refunds policy",
          "info": "Refund policy must be added into your store policies. [Learn more](https://help.shopify.com/manual/sell-online/checkout-settings/refund-privacy-tos).",
          "default": true
        }
      ]
    },
    {
      "type": "trust",
      "name": "Trust content",
      "settings": [
        {
          "type": "text",
          "id": "trust_title",
          "label": "Heading",
          "default": "Payment & Security"
        },
        {
          "type": "checkbox",
          "id": "show_payment_icons",
          "label": "Show payment icons",
          "default": true
        },
        {
          "type": "image_picker",
          "id": "custom_security_badge",
          "label": "Security badge",
          "info": "800 x 200px .jpg recommended"
        },
        {
          "type": "range",
          "id": "custom_security_badge_width",
          "min": 100,
          "max": 500,
          "step": 10,
          "unit": "px",
          "label": "Security badge width",
          "default": 200,
          "visible_if": "{{ block.settings.custom_security_badge != blank }}"
        }
      ]
    },
    {
      "type": "icon_text",
      "name": "Icon with text",
      "settings": [
        {
          "type": "image_picker",
          "id": "icon_1",
          "label": "Icon 1"
        },
        {
          "type": "richtext",
          "id": "text_1",
          "label": "Text 1"
        },
        {
          "type": "image_picker",
          "id": "icon_2",
          "label": "Icon 2"
        },
        {
          "type": "richtext",
          "id": "text_2",
          "label": "Text 2"
        },
        {
          "type": "image_picker",
          "id": "icon_3",
          "label": "Icon 3"
        },
        {
          "type": "richtext",
          "id": "text_3",
          "label": "Text 3"
        },
        {
          "type": "image_picker",
          "id": "icon_4",
          "label": "Icon 4"
        },
        {
          "type": "richtext",
          "id": "text_4",
          "label": "Text 4"
        },
        {
          "type": "image_picker",
          "id": "icon_5",
          "label": "Icon 5"
        },
        {
          "type": "richtext",
          "id": "text_5",
          "label": "Text 5"
        },
        {
          "type": "image_picker",
          "id": "icon_6",
          "label": "Icon 6"
        },
        {
          "type": "richtext",
          "id": "text_6",
          "label": "Text 6"
        }
      ]
    },
    {
      "type": "@app"
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "Media"
    },
    {
      "type": "paragraph",
      "content": "Learn more about [media types](https://help.shopify.com/en/manual/products/product-media)"
    },
    {
      "type": "select",
      "id": "image_size",
      "label": "Size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "small"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "label": "Enable video looping",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_image_zoom",
      "label": "Enable image zoom",
      "default": true
    },
    {
      "type": "select",
      "id": "image_zoom_type",
      "label": "Image zoom type",
      "options": [
        {
          "label": "default",
          "value": "default"
        },
        {
          "label": "fancybox",
          "value": "fancybox"
        }
      ],
      "default": "fancybox"
    },
    {
      "type": "select",
      "id": "zoom_effect",
      "label": "Desktop zoom effect",
      "options": [
        {
          "value": "inside",
          "label": "Inside"
        },
        {
          "value": "outside",
          "label": "Outside"
        }
      ],
      "default": "outside",
      "visible_if": "{{ section.settings.enable_image_zoom }}"
    },
    {
      "type": "select",
      "id": "carousel_effect",
      "label": "Transition effect",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        }
      ],
      "default": "fade"
    }
  ]
}
{% endschema %}
