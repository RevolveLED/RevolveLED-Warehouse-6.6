<div class="text-center">
  <div class="container container--narrow container-page-title">
    <h1 class="page__title heading h1 ">{{ page.title }}</h1>
    {% if page.content contains '[abovetext]' %}
      {% assign content = page.content | split: '[abovetext]' %}
      
      {{ content[0] }}
    {% else %}
      {{ page.content }}
    {% endif %}
  </div>
</div>

<div class="container container--narrow page-outlet">
  {%- for block in section.blocks -%}
    {%- capture section_settings -%}
{
  "stackable": {% if block.settings.layout == 'vertical' and block.settings.stack_desktop == false %}false{% else %}true{% endif %},
  "layout": {{ block.settings.layout | json }}
}
{%- endcapture -%}

    <style>
      .section-{{ block.id }} .box{
        {% if block.settings.color_theme == '#eff8ff' %}
         	background:{{ block.settings.color_theme}};
        {% endif %}

      }
      .section-{{ block.id }} .product-item .box::after{
        border-color:{{ block.settings.color_theme}};
      }
      {% if block.settings.orange_cart %}
        .section-{{ block.id }} .box .button--primary {
              background: #eb6100 ;
        }
      {% endif %}
    </style>

    <section
      class="section section-{{ block.id }} featured-collection setion-margin-topandbottom0"
      data-section-id="{{ block.id }}"
      data-section-type="featured-collection"
      data-section-settings="{{ section_settings }}"
    >
      {%- assign collection = collections[block.settings.collection] -%}

      <div class="container">
        <h2 class="h2-font-weight">
          <a href="{{collection.url}}"> {{ collection.title }} </a>
        </h2>
      </div>

      <div class="container {% if block.settings.layout != 'vertical' %}container--flush{% endif %}">
        {%- capture product_list -%}
      <div class="new-product-list product-list--{{ block.settings.layout }} {% if block.settings.layout == 'vertical' %}product-list--scrollable{% endif %} {% if block.settings.stack_desktop %}product-list--stackable{% endif %}">
        {%- assign use_placeholder = true -%}

        {%- if collection.empty? -%}
          {%- assign products = (1..block.settings.products_count) -%}
        {%- else -%}
          {%- assign products = collection.products -%}
          {%- assign use_placeholder = false -%}
        {%- endif -%}

        {%- for product in products limit: block.settings.products_count -%} 
          {%- if block.settings.layout == 'vertical' -%}
            {%- if use_placeholder -%}
              {%- include 'product-item-placeholder', product: product, grid_classes: '1/4--lap 1/4--desk 1/4--wide', show_add_to_cart: block.settings.show_quick_buy -%}
            {%- else -%}
              {%- include 'product-item', product: product, grid_classes: '1/4--lap 1/4--desk 1/4--wide', show_add_to_cart: block.settings.show_quick_buy -%}
            {%- endif -%}
        
          {%- elsif block.settings.layout == 'horizontal' -%}
            {%- if use_placeholder -%}
              {%- include 'product-item-placeholder', product: product, horizontal: true, grid_classes: '1/2--tablet 1/3--lap-and-up', show_add_to_cart: false -%}
            {%- else -%}
              {%- include 'product-item', product: product, horizontal: true, grid_classes: '1/2--tablet 1/3--lap-and-up', show_add_to_cart: false -%}
            {%- endif -%}
        
          {%- else -%}
            {%- assign mod = forloop.index0 | modulo: 3 -%}

            {%- if mod == 0 -%}
              <div class="product-list__column product-list__column--highlight">
                
            {%- elsif mod == 1 -%}
              <div class="product-list__column {% if forloop.last %}product-list__column--shrink{% endif %}">
            {%- endif -%}

            {%- if mod == 0 -%}
              {%- if use_placeholder -%}
                {%- include 'product-item-placeholder', product: product, show_add_to_cart: false -%}
              {%- else -%}
                {%- include 'product-item', product: product, show_add_to_cart: false -%}
              {%- endif -%}
            {%- else -%}
              {%- if use_placeholder -%}
                {%- include 'product-item-placeholder', product: product, horizontal: true, show_add_to_cart: false -%}
              {%- else -%}
                {%- include 'product-item', product: product, horizontal: true, show_add_to_cart: false -%}
              {%- endif -%}
            {%- endif -%}

            {%- if mod == 0 or mod == 2 or forloop.last -%}
              </div>
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
                
      </div>
    {%- endcapture -%}

        {{ product_list }}

        {%- comment -%}
          --------------------------------------------------------------------------------------
          QUICK VIEW CONTAINER
          --------------------------------------------------------------------------------------
        {%- endcomment -%}

        <div id="modal-quick-view-{{ block.id }}" class="modal" aria-hidden="true">
          <div class="modal__dialog modal__dialog--stretch" role="dialog">
            <button class="modal__close link" data-action="close-modal">{%- render 'icon', icon: 'close' -%}</button>

            <div class="modal__loader">
              {%- render 'icon', icon: 'search-loader' -%}
            </div>

            <div class="modal__inner"></div>
          </div>
        </div>
      </div>
    </section>
  {%- endfor -%}

  {% if page.content contains '[abovetext]' %}
    <div class="container">
      <div class="container-paddin bgc-f5f5f5">
        {{ content[1] }}
      </div>
    </div>
    <br>
  {% endif %}
</div>
{% schema %}
{
  "name": "Collection outlet",
  "settings": [
    {
      "type": "select",
      "id": "show_quick_buy",
      "label": "Show quick buy on...",
      "options": [
        {
          "value": "list",
          "label": "List view"
        },
        {
          "value": "list_grid",
          "label": "List and grid views"
        }
      ],
      "default": "list"
    }
  ],
  "blocks": [
    {
      "type": "outlet",
      "name": "outlet",
      "settings": [
        {
          "type": "select",
          "id": "color_theme",
          "label": "Color theme",
          "options": [
            {
              "value": "#eff8ff",
              "label": "blue"
            },
            {
              "value": "#eb6100",
              "label": "orange"
            }
          ]
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },

        {
          "type": "range",
          "id": "products_count",
          "label": "Products to show",
          "min": 4,
          "max": 50,
          "step": 1,
          "default": 12
        },
        {
          "type": "select",
          "id": "layout",
          "label": "Layout",
          "options": [
            {
              "value": "vertical",
              "label": "Vertical"
            },
            {
              "value": "horizontal",
              "label": "Horizontal"
            },
            {
              "value": "collage",
              "label": "Collage"
            }
          ],
          "default": "vertical"
        },

        {
          "type": "checkbox",
          "id": "orange_cart",
          "label": "Orange cart",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "show_tab",
          "label": "Show tab",
          "default": false
        },
        {
          "type": "text",
          "id": "tab",
          "label": "tab"
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Custom",
      "name": "Collection outlet",
      "settings": {}
    }
  ]
}
{% endschema %}
