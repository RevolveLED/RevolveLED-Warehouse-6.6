<div class="product-info">
  {%- if section.settings.enable_image_zoom -%}
    <div id="product-zoom-{{ section.id }}" class="product__zoom-wrapper"></div>
  {%- endif -%}

  <div class="product-info__inner">
    <product-form>
      {%- form 'product', product, id: product_form_id, class: 'product-form' -%}
        {%- for block in section.blocks -%}
          <div
            class="product-info__block-item product-info__block-item--{{ block.type | replace: '_', '-' }}"
            data-block-id="{{ block.id }}"
            data-block-type="{{ block.type | replace: '_', '-' }}"
            {% unless block.type == '@app' or block.type == 'accordion' %}
              {{- block.shopify_attributes -}}
            {% endunless %}
          >
            {%- case block.type -%}
              {%- when 'product_meta' -%}
                {%- render 'product-meta', product: product, block: block, update_url: update_url -%}

              {%- when 'variant_selector' -%}
                {%- render 'product-variant-selector',
                  product: product,
                  product_form_id: product_form_id,
                  update_url: update_url,
                  block: block
                -%}

              {%- when 'volume_pricing' -%}
                {%- render 'volume-pricing-table', variant: product.selected_or_first_available_variant -%}

              {%- when 'buy_buttons' -%}
                {%- render 'product-buy-buttons', product: product, form: form, block: block -%}

              {%- when 'text' -%}
                {%- if block.settings.content != blank -%}
                  <div class="product-meta__text rte">
                    {{- block.settings.content -}}
                  </div>
                {%- endif -%}

              {%- when 'button' -%}
                {%- if block.settings.text != blank -%}
                  <a href="{{ block.settings.link }}" class="product-meta__button button button--primary">
                    {{- block.settings.text | escape -}}
                  </a>
                {%- endif -%}

              {%- when 'store_pickup' -%}
                {%- comment -%}The availability container will be added automatically if there is store pickup available{%- endcomment -%}
                <div class="product-meta__store-availability-container">
                  {%- render 'store-availability', product_variant: product.selected_or_first_available_variant -%}
                </div>

              {%- when 'featured_description' -%}
                {%- comment -%}This is only shown on the featured product section{%- endcomment -%}
                {%- if product.description != blank -%}
                  <div class="product-meta__description rte">
                    {{ product.description | remove: 'data-section-type="product"' }}
                  </div>
                {%- endif -%}
                {%- comment -%}
                  --------------------------------------------------------------------------------------
                  DESCRIPTION
                  --------------------------------------------------------------------------------------
                {%- endcomment -%}

              {%- when 'description' -%}
                {%- if product.description != blank -%}
                  <div
                    class="product-block-list__item product-block-list__item--description"
                    {{ block.shopify_attributes }}
                  >
                    <div>
                      {%- if block.settings.display_mode == 'collapse' -%}
                        <button
                          class="card__collapsible-button"
                          data-action="toggle-collapsible"
                          aria-expanded="false"
                          aria-controls="block-{{ section.id }}-{{ block.id }}"
                        >
                          <span class="card__title heading h3">{{ 'product.general.description' | t }}</span>
                          <span class="plus-button plus-button--large"></span>
                        </button>

                        <div id="block-{{ section.id }}-{{ block.id }}" class="card__collapsible">
                          <div class="card__collapsible-content">
                            <div class="rte text--pull">
                              {{ product.description | remove: 'data-section-type="product"' }}
                            </div>
                          </div>
                        </div>
                      {%- else -%}
                        <hr class="card__separator">
                        <h2 class="heading h3">{{ 'product.general.description' | t }}</h2>

                        <div
                          class="{% if block.settings.display_mode == 'view_more' %}expandable-content{% endif %}"
                          {% if block.settings.display_mode == 'view_more' %}
                            aria-expanded="false"
                          {% endif %}
                        >
                          <div class="rte text--pull">
                            {{ product.description | remove: 'data-section-type="product"' }}
                          </div>

                          {%- if block.settings.display_mode == 'view_more' -%}
                            <button class="expandable-content__toggle">
                              <span class="expandable-content__toggle-icon"></span>
                              <span
                                class="expandable-content__toggle-text"
                                data-view-more="{{ 'product.general.view_more' | t | escape }}"
                                data-view-less="{{ 'product.general.view_less' | t | escape }}"
                              >
                                {{- 'product.general.view_more' | t -}}
                              </span>
                            </button>
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    </div>
                  </div>
                {%- endif -%}

              {%- when 'content' -%}
                {%- comment -%}
                  --------------------------------------------------------------------------------------
                  CONTENT (we first check the page and then inline content)
                  --------------------------------------------------------------------------------------
                {%- endcomment -%}

                {%- assign page = block.settings.page -%}

                {%- if page != blank -%}
                  {%- assign title = page.title -%}
                  {%- assign content = page.content -%}
                {%- else -%}
                  {%- assign title = block.settings.title -%}
                  {%- assign content = block.settings.content -%}
                {%- endif -%}

                {%- if title != blank and content != blank -%}
                  <div
                    class="product-block-list__item product-block-list__item--content"
                    {{ block.shopify_attributes }}
                  >
                    <div>
                      {%- if block.settings.display_mode == 'collapse' -%}
                        <button
                          class="card__collapsible-button"
                          data-action="toggle-collapsible"
                          aria-expanded="false"
                          aria-controls="block-{{ section.id }}-{{ block.id }}"
                        >
                          <span class="card__title heading h3">{{ title }}</span>
                          <span class="plus-button plus-button--large"></span>
                        </button>

                        <div id="block-{{ section.id }}-{{ block.id }}" class="card__collapsible">
                          <div class="card__collapsible-content">
                            <div class="rte text--pull">
                              {{ content }}
                            </div>
                          </div>
                        </div>
                      {%- else -%}
                        <div class="card__header">
                          <h2 class="card__title heading h3">{{ title }}</h2>
                        </div>

                        <div
                          class="card__section {% if block.settings.display_mode == 'view_more' %}expandable-content{% endif %}"
                          {% if block.settings.display_mode == 'view_more' %}
                            aria-expanded="false"
                          {% endif %}
                        >
                          <div class="rte text--pull">
                            {{ content }}
                          </div>

                          {%- if block.settings.display_mode == 'view_more' -%}
                            <button class="expandable-content__toggle">
                              <span class="expandable-content__toggle-icon"></span>
                              <span
                                class="expandable-content__toggle-text"
                                data-view-more="{{ 'product.general.view_more' | t | escape }}"
                                data-view-less="{{ 'product.general.view_less' | t | escape }}"
                              >
                                {{- 'product.general.view_more' | t -}}
                              </span>
                            </button>
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    </div>
                  </div>
                {%- endif -%}

              {%- when 'liquid' -%}
                {%- comment -%}
                  --------------------------------------------------------------------------------------
                  LIQUID CODE
                  --------------------------------------------------------------------------------------
                {%- endcomment -%}

                {%- assign title = block.settings.title -%}
                {%- assign liquid = block.settings.liquid -%}

                <div
                  class="product-block-list__item product-block-list__item--content"
                  data-block-type="{{ block.type }}"
                  data-block-id="{{ block.id }}"
                  {{ block.shopify_attributes }}
                >
                  {%- if title != blank and liquid != blank -%}
                    <div>
                      {%- if block.settings.display_mode == 'collapse' -%}
                        <button
                          class="card__collapsible-button"
                          data-action="toggle-collapsible"
                          aria-expanded="false"
                          aria-controls="block-{{ section.id }}-{{ block.id }}"
                        >
                          <span class="card__title heading h3">{{ title }}</span>
                          <span class="plus-button plus-button--large"></span>
                        </button>

                        <div id="block-{{ section.id }}-{{ block.id }}" class="card__collapsible">
                          <div class="card__collapsible-content">
                            <div class="rte text--pull">
                              {{ liquid }}
                            </div>
                          </div>
                        </div>
                      {%- else -%}
                        <div class="card__header">
                          <h2 class="card__title heading h3">{{ title }}</h2>
                        </div>

                        <div
                          class="card__section {% if block.settings.display_mode == 'view_more' %}expandable-content{% endif %}"
                          {% if block.settings.display_mode == 'view_more' %}
                            aria-expanded="false"
                          {% endif %}
                        >
                          <div class="rte text--pull">
                            {{ liquid }}
                          </div>

                          {%- if block.settings.display_mode == 'view_more' -%}
                            <button class="expandable-content__toggle">
                              <span class="expandable-content__toggle-icon"></span>
                              <span
                                class="expandable-content__toggle-text"
                                data-view-more="{{ 'product.general.view_more' | t | escape }}"
                                data-view-less="{{ 'product.general.view_less' | t | escape }}"
                              >
                                {{- 'product.general.view_more' | t -}}
                              </span>
                            </button>
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>

                {%- comment -%}
                  --------------------------------------------------------------------------------------
                  COMPLEMENTARY PRODUCTS
                  --------------------------------------------------------------------------------------
                {%- endcomment -%}
              {%- when 'complementary_products' -%}
                <product-recommendations
                  class="product-block-list__item product-block-list__item--complementary"
                  intent="complementary"
                  product="{{ product.id }}"
                  limit="{{ block.settings.products_count }}"
                  section-id="{{ section.id }}"
                  {{ block.shopify_attributes }}
                >
                  {%- if recommendations.performed and recommendations.products_count > 0 -%}
                    <div>
                      <div class="card__header">
                        <h2 class="card__title heading h3">{{ block.settings.title | escape }}</h2>
                      </div>

                      <div class="card__section">
                        <div class="complementary-product-list">
                          {%- for product in recommendations.products -%}
                            {%- render 'product-item',
                              product: product,
                              horizontal: true,
                              hide_labels: true,
                              show_add_to_cart: block.settings.show_quick_buy,
                              complementary_products: true
                            -%}
                          {%- endfor -%}
                        </div>
                      </div>
                    </div>
                  {%- endif -%}
                </product-recommendations>

                {%- comment -%}
                  --------------------------------------------------------------------------------------
                  TRUST BADGE
                  --------------------------------------------------------------------------------------
                {%- endcomment -%}

              {%- when 'trust' -%}
                {%- if block.settings.show_payment_icons and shop.enabled_payment_types.size > 0 -%}
                  {%- assign show_payment_icons = true -%}
                {%- else -%}
                  {%- assign show_payment_icons = false -%}
                {%- endif -%}

                {%- if block.settings.custom_security_badge or show_payment_icons -%}
                  <div class="product-block-list__item product-block-list__item--trust">
                    <div>
                      <div class="card__header card__header--flex">
                        <h2 class="card__title heading h3">{{ block.settings.trust_title | escape }}</h2>

                        {%- render 'icon', icon: 'lock', width: 22, height: 24 -%}
                      </div>

                      <div class="card__section">
                        {%- if show_payment_icons -%}
                          {%- if block.settings.custom_security_badge -%}
                            <p class="card__subtitle heading h6">{{ 'product.general.payment' | t }}</p>
                          {%- endif -%}

                          <div class="payment-list">
                            {% for type in shop.enabled_payment_types %}
                              {{ type | payment_type_svg_tag: class: 'payment-list__item' }}
                            {% endfor %}
                          </div>

                          <p class="payment-list__notice">{{ 'product.general.payment_notice' | t }}</p>
                        {%- endif -%}

                        {%- if show_payment_icons and block.settings.custom_security_badge -%}
                          <hr class="card__separator">
                        {%- endif -%}

                        {%- if block.settings.custom_security_badge -%}
                          {%- if show_payment_icons -%}
                            <p class="card__subtitle heading h6">{{ 'product.general.security' | t }}</p>
                          {%- endif -%}

                          {%- assign badge_width = block.settings.custom_security_badge.width
                            | at_most: 450
                            | append: 'x'
                          -%}
                          <img
                            class="product__trust-badge"
                            style="width: {{ block.settings.custom_security_badge_width }}px"
                            loading="lazy"
                            width="{{ block.settings.custom_security_badge.width }}"
                            height="{{ block.settings.custom_security_badge.height }}"
                            src="{{ block.settings.custom_security_badge | img_url: badge_width }}"
                            srcset="{{ block.settings.custom_security_badge | img_url: badge_width }} 1x, {{ block.settings.custom_security_badge | img_url: badge_width, scale: 2 }} 2x"
                            alt="{{ block.settings.custom_security_badge.alt | escape }}"
                          >
                        {%- endif -%}
                      </div>
                    </div>
                  </div>
                {%- endif -%}

                {%- comment -%}
                  --------------------------------------------------------------------------------------
                  ESTIMATE SHIPPING
                  --------------------------------------------------------------------------------------
                {%- endcomment -%}

              {%- when 'shipping_estimator' -%}
                {%- if product.available -%}
                  <div
                    class="product-block-list__item product-block-list__item--shipping"
                    {{ block.shopify_attributes }}
                  >
                    <div>
                      <div class="card__header">
                        <h2 class="card__title heading h3">{{ 'product.general.estimate_shipping' | t }}</h2>
                      </div>

                      <div class="card__section">
                        <div class="shipping-estimator form" role="form">
                          <div class="form__input-row">
                            <div class="form__input-wrapper">
                              <label for="shipping-estimator-country" class="form__label">
                                {{- 'cart.shipping_estimator.country' | t -}}
                              </label>

                              <div class="select-wrapper select-wrapper--primary">
                                {%- render 'icon', icon: 'arrow-bottom' -%}

                                <select
                                  name="country"
                                  id="shipping-estimator-country"
                                  data-default="{{ customer.default_address.country | default: block.settings.shipping_estimator_default_country }}"
                                  required
                                >
                                  {{- country_option_tags -}}
                                </select>
                              </div>
                            </div>

                            <div class="form__input-wrapper" style="display: none">
                              <label for="shipping-estimator-province" class="form__label">
                                {{- 'cart.shipping_estimator.province' | t -}}
                              </label>

                              <div class="select-wrapper select-wrapper--primary">
                                {%- render 'icon', icon: 'arrow-bottom' -%}

                                <select
                                  name="province"
                                  id="shipping-estimator-province"
                                  data-default="{{ customer.default_address.province }}"
                                ></select>
                              </div>
                            </div>

                            <div class="form__input-wrapper" style="max-width: 155px">
                              <label for="shipping-estimator-zip" class="form__label">
                                {{- 'cart.shipping_estimator.zip_code' | t -}}
                              </label>
                              <input
                                type="text"
                                name="zip"
                                id="shipping-estimator-zip"
                                class="form__field form__field--text"
                                value="{{ customer.default.address.zip }}"
                                required
                              >
                            </div>
                          </div>

                          <button
                            type="button"
                            class="form__submit button button--primary"
                            data-action="estimate-shipping"
                          >
                            {{ 'cart.shipping_estimator.estimate' | t }}
                          </button>

                          <div class="shipping-estimator__results rte" style="display: none;"></div>
                        </div>
                      </div>

                      {%- if block.settings.show_refunds_policy and shop.refund_policy != blank -%}
                        <div class="card__section card__section--tight">
                          <button
                            class="product__refund-policy-link link link--accented"
                            data-action="open-modal"
                            aria-controls="modal-refunds-policy"
                          >
                            {{ 'product.general.refund_policy' | t }}
                            {%- render 'icon', icon: 'arrow-right' -%}
                          </button>
                        </div>
                      {%- endif -%}
                    </div>

                    {%- if block.settings.show_refunds_policy and shop.refund_policy != blank -%}
                      <div id="modal-refunds-policy" class="modal" aria-hidden="true">
                        <div class="modal__dialog" role="dialog">
                          <header class="modal__header">
                            <h3 class="modal__title heading h2">{{ 'product.general.refund_policy' | t }}</h3>
                            <button
                              class="modal__close link"
                              data-action="close-modal"
                              title="{{ 'general.accessibility.close' | t | escape }}"
                            >
                              {%- render 'icon', icon: 'close' -%}
                            </button>
                          </header>

                          <div class="modal__content">
                            <div class="rte">
                              {{ shop.refund_policy }}
                            </div>
                          </div>
                        </div>
                      </div>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              {%- when 'icon_text' -%}
                <!-- icon_text -->
                <ul class="hidden-pocket">
                  {%- for n in (1..6) -%}
                    {%- liquid
                      assign icon_key = 'icon_' | append: n
                      assign text_key = 'text_' | append: n
                      assign icon = block.settings[icon_key]
                      assign text = block.settings[text_key]
                      if icon == blank and text == blank
                        continue
                      endif
                    -%}
                    <li>
                      <img
                        src="{{ icon | image_url  }}"
                        width="{{ icon.width }}"
                        height="{{ icon.height }}"
                        alt="{{ icon.alt | escape }}"
                        loading="lazy"
                      >
                      <span>{{ text }}</span>
                    </li>
                  {%- endfor -%}
                </ul>
              {%- when '@app' -%}
                {%- render block -%}
            {%- endcase -%}
          </div>
        {%- endfor -%}

        {%- assign product_meta_block = section.blocks | where: 'type', 'product_meta' | first -%}

        {%- if product_meta_block != blank and product_meta_block.settings.show_share_buttons -%}
          <div class="product-meta__share-buttons hidden-tablet-and-up">
            <span class="text--strong">{{ 'product.general.share' | t }}</span>

            {%- assign share_url = shop.url | append: product.url | url_param_escape -%}
            {%- assign twitter_text = product.title | url_param_escape -%}
            {%- assign pinterest_description = product.description
              | strip_html
              | truncatewords: 15
              | url_param_escape
            -%}
            {%- assign pinterest_image = product.featured_media | img_url: '1024x' | prepend: 'https:' -%}

            <ul class="social-media__item-list list--unstyled" role="list">
              <li class="social-media__item social-media__item--facebook">
                <a
                  href="https://www.facebook.com/sharer.php?u={{ share_url }}"
                  target="_blank"
                  rel="noopener"
                  aria-label="{{ 'general.social.facebook_share' | t }}"
                >
                  {%- render 'icon', icon: 'facebook' -%}
                </a>
              </li>

              <li class="social-media__item social-media__item--pinterest">
                <a
                  href="https://pinterest.com/pin/create/button/?url={{ share_url }}{% if pinterest_image != blank %}&media={{ pinterest_image }}{% endif %}&description={{ pinterest_description }}"
                  target="_blank"
                  rel="noopener"
                  aria-label="{{ 'general.social.pinterest_pin' | t }}"
                >
                  {%- render 'icon', icon: 'pinterest' -%}
                </a>
              </li>

              <li class="social-media__item social-media__item--twitter">
                <a
                  href="https://twitter.com/intent/tweet?{% if twitter_text != blank %}text={{twitter_text}}&{% endif %}url={{ share_url }}"
                  target="_blank"
                  rel="noopener"
                  aria-label="{{ 'general.social.twitter_tweet' | t }}"
                >
                  {%- render 'icon', icon: 'twitter' -%}
                </a>
              </li>

              <li class="social-media__item">
                <a
                  href="mailto:?&subject={{ product.title | escape }}&body={{ share_url }}"
                  aria-label="{{ 'general.social.email_share' | t }}"
                >
                  {%- render 'icon', icon: 'email' -%}
                </a>
              </li>
            </ul>
          </div>
        {%- endif -%}
      {%- endform -%}
    </product-form>

    {%- render 'product-short-desc', class: 'hidden-lap-and-up' -%}
  </div>
</div>
